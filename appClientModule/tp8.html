<html>
<body>
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <div id="container">
        <div id="header">
            <div id="header_toprow">
                Conservatoire national des arts et métiers
            </div>
            <div id="header_title">
                NFP121 : Programmation avancée<br />
                TP n° 8 - Pattern Décorateur
            </div>
        </div>
        <div id="content">

            <div class="paragraphe">
                Thèmes du TP :<br />
                <ul>
                    <li><a href="http://www.eli.sdsu.edu/courses/spring01/cs635/notes/decorator/decorator.html" target="_blank">Pattern Décorateur</a></li>
                    <li>
                    <a target="_blank" href="http://jfod.cnam.fr/NFP121/Chapter03_Head_First.pdf">Le chapitre 3</a> extrait de Head First Design Patterns 
                    O'Reilly<br>
                    les
                    <a href="https://github.com/bethrobson/Head-First-Design-Patterns">
                    exemples</a> de ce livre : </li>
                    <li>Les pré et post assertions, invariant de classe comme 
                    décorations d'une classe.</li>
                    <li>Décorer une classe "InputStream"</li>
                </ul>
            </div>
            <br />
            <hr />

            <div class="question">
                <img src="images/question1.png" width="101" height="80" />
                <span>Une applette à compléter : une PIZZA cela se décore !!!</span>
            </div>

            <div class="paragraphe">
                Utilisation du pattern Décorateur pour l'élaboration d'une pizza : Les pizzas, 3 sortes (Classic, PizzaSolo ou GenerousCrust) sont ici "décorées" par des ingrédients avant d'être confectionnées (MAKING Pizza) et le prix dépend bien sur de cette composition. On "résume" cela par l'architecture suivante : 
            </div>

            <p align="center">
                <img class="win_screenshot" src="images/bluej1.png" width="850" height="481" />
            </p>

            <div class="paragraphe">
                Alors, la création d'une pizza à pâte "Classic" avec deux doses de Jambon ("Ham") et avec des champignons  ("Mushrooms) sera "confectionnée" en Java par : 
            </div>

            <div class="codesource">
                <code>
                    <font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#000000">Pizza&nbsp;pizza&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">Mushrooms</font><font color="#000000">(</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">Ham</font><font color="#000000">(</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">Ham</font><font color="#000000">(&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">Classic</font><font color="#000000">()))</font><font color="#000000">;</font>

                </code>
            </div>

            <div class="paragraphe">
                <b>Complétez</b> l'applette "PizzaStore" qui permet :<br />
                <ul>
                    <li>d'élaborer une pizza à la demande, et</li>
                    <li>de calculer son prix "en temps réel" au fur et à mesure des désirs de l'acheteur</li>
                </ul>
                <b>Remarque :</b>  ce qui est dit est dit, on ne peut pas revenir en arrière dans la commande... 
            </div>
            <br />

            <p align="center">
                Applette au comportement souhaité
            </p>

            <applet code="question1.PizzaStore" codebase="./" align="middle" width="800" height="220"><param name="archive" value="applettes.jar"></applet>

            <hr />
            <div class="question">
                <img src="images/question2_1.png" width="111" height="80" />
                <span>Complétez cette architecture</span>
            </div>

            <div class="paragraphe">
                L'exemple présenté dans le <a href="http://www.oreilly.com/catalog/hfdesignpat/chapter/ch03.pdf" target="_blank">chapitre 3</a> extrait de <a href="http://www.wickedlysmart.com/HeadFirst/HeadFirstDesignPatterns/HeadFirstPatternsIndex.html" target="_blank">Head First Design Patterns</a>, décrit une boisson et des compléments possibles. Le pattern décorateur est utilisé afin, de "décorer" la boisson choisie avec les souhaits d'un client d'une part, et de fournir au client le prix exact de la boisson qu'il a commandée d'autre part.<br />
                <br />
                Exemple : un café corsé avec du lait, s'écrit:<br />
            </div>
            <div class="codesource">
                <code>
                    <font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#000000">Beverage&nbsp;darkRoastWithMilk&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">Milk</font><font color="#000000">(</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">DarkRoast</font><font color="#000000">())</font><font color="#000000">;</font>
                </code>
            </div>
            <div class="paragraphe">
                et l'obtention de son prix :<br />
            </div>

            <div class="codesource">
                <code>
                    <font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>double&nbsp;</b></font><font color="#000000">price&nbsp;=&nbsp;darkRoastWithMilk.cost</font><font color="#000000">()</font><font color="#000000">;&nbsp;</font>
                </code>
            </div>

            <p align="center">
                <img class="win_screenshot" src="images/bluej2.png" width="686" height="475" />
            </p>

            <div class="paragraphe">
                Les différentes boissons héritent de la classe abstraite <b>Beverage</b>,<br />
                La classe abstraite <b>CondimentDecorator</b>, instance du pattern Décorateur, représente les exigences possibles du client...<br />
                <br />
                On demande de compléter cette architecture en ajoutant le chocolat (classe <b>Chocolate</b>) comme boisson, le coût de cette boisson est de <b>2.10</b> et de compléter toutes les méthodes de la classe de test ChocolateTest, les méthodes correspondent aux boissons suivantes:
                <ul>
                    <li>un chocolat seul</li>
                    <li>un chocolat avec de la crème(Whip)</li>
                    <li>un chocolat avec deux rations de crème</li>
                    <li>un chocolat avec de la crème, du soja(soy) et du moka(mocha),... ( les goûts ne se discutent pas ...)</li>
                    <li>un café décaféiné avec du lait</li>
                </ul>
            </div>

            <p align="center">
                <img class="win_screenshot" src="images/bluej3.png" width="406" height="347" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <img class="win_screenshot" src="images/bluej4.png" width="378" height="375" />
            </p>
            <hr />

            <div class="question">
                <img src="images/question2_2.png" width="111" height="80" />
                <span>Le condiment sucre de betteraves (classe BeetSugar)</span>
            </div>

            <div class="paragraphe">
                <b>Ajouter</b> le condiment sucre de betteraves, (classe <b>BeetSugar</b>), dont le coût est de 0.1, sa description : "<b>Beet Sugar</b>".&nbsp; 
                Attention à l'espace entre Beet et Sugar.</div>
            <br />
            <hr />

            <div class="question">
                <img src="images/question2_3.png" width="111" height="80" />
                <span>La méthode toString()</span>
            </div>

            <div class="paragraphe">
                <b>Ajouter</b> la méthode <b>public String toString();</b> qui se contente de retourner <b>la description et le coût</b> du produit choisi par le client, selon ce format <i>description $cost</i><br />
                <br />
                un exemple : une trace de la description attendue<br />
                <div class="codesource">
                    <code>
                        <font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#000000">Beverage&nbsp;b&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">BeetSugar</font><font color="#000000">(</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">Whip</font><font color="#000000">(</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">Mocha</font><font color="#000000">(</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">Soy</font><font color="#000000">(</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">HouseBlend</font><font color="#000000">()))))</font><font color="#000000">;</font>
                        <br />
                        <font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#000000">System.out.println</font><font color="#000000">(</font><font color="#000000">b</font><font color="#000000">)</font><font color="#000000">;</font>
                    </code>
                </div>

            <p align="center">Trace attendue<br />
                <img class="win_screenshot" src="images/bluej5.png" width="578" height="175" />
            </p>

            </div>
            <br />
            <hr />

            <div class="question">
                <img src="images/question3.png" width="101" height="80" /> Pré 
                Post assertions et invariant de classe
            </div>

            <div class="paragraphe">
                <p class="paragraphe">&nbsp;&nbsp;&nbsp; Soit une implémentation 
                d'une file d'entiers (de type FIFO, Premier entré, premier 
                sorti) réalisée par la classe <b>QueueImpl</b> et une autre 
                implémentation d'une file d'entiers, (classe <b>
                QueuePriorityImpl)</b>, cette file ajoute une priorité de sortie 
                aux éléments, la priorité par souci de simplification est 
                associée à la valeur de l'entier, une valeur de l'entier élevée 
                indique une priorité forte. Le fonctionnement est analogue à la 
                classe <b>
                <a href="http://docs.oracle.com/javase/7/docs/api/java/util/PriorityQueue.html">
                PriorityQueue</a></b> du paquetage java.util dont il est 
                souhaitable de lire la documentation avant de commencer la réalisation. </p>
                <blockquote>
                <p class="paragraphe">
                <img border="0" src="tp8.ht112.jpg" width="882" height="317"></p>
                </blockquote>
                <p class="paragraphe">Les décorateurs QueuePrePost, QueueRepOk 
                et QueueAf permettent de &quot;vérifier&quot;, sur une instance de la 
                classe QueueImpl, à l'aide de tests unitaires, certaines 
                propriétés comme :</p>
                <blockquote>
                  <ul>
                    <li>
                    <p class="paragraphe">les pré et post assertions pour chaque 
                    méthode (classe QueuePrePost)</li>
                    <li>
                    <p class="paragraphe">l'invariant de classe (classe 
                    QueueRepOk)</li>
                    <li>
                    <p class="paragraphe">le bon raffinement à l'aide de la 
                    fonction d'abstraction ( classe QueueAf )</li>
                  </ul>
                </blockquote>
                <p class="paragraphe">Les décorateurs PriorityQueuePrePost, 
                PriorityQueueRepOk et PriorityQueueAf permettent de &quot;vérifier&quot;, 
                sur une instance de la classe PriorityQueueImpl, certaines 
                propriétés héritées ou locales. </p>
                <p class="paragraphe">Proposez les classes <b>QueueImpl</b> et
                <b>PriorityQueueImpl</b> et complétez les décorateurs <b>QueueAf</b> et <b>
                PriorityQueueAf</b>. Les classes complétées doivent permettre 
                l'exécution sans échec de toutes les méthodes des classes de 
                tests unitaires fournies.<p class="paragraphe">&nbsp;<p class="paragraphe">
                Le paquetage fifo contient les implémentations de file 
                résultantes de vos fonctions d'abstraction, nota bene 
                l'architecture ci-dessous utilise les patrons Adaptateur et Fabrique.<blockquote>
                  <p class="paragraphe">
                <img border="0" src="tp8.ht211.jpg" width="871" height="385"></blockquote>
                <p class="paragraphe">&nbsp;</div>


            <p class="paragraphe">&nbsp;</p>
            <hr />

            <div class="question">
                <img src="images/question4_1.png" width="111" height="80" />
                <span>I/O JAVA et pattern décorateur</span>
            </div>

            <p align="center">
                <img class="win_screenshot" src="images/bluej6.png" width="693" height="371" />
            </p>

            <div class="paragraphe">
                Ci-dessus le décorateur (incomplet) des entrées-sorties en Java, package java.io + la classe  <b>UpperCaseInputStream</b> à développer<br />
                <br />
                Proposez la classe <b>UpperCaseInputStream</b> (en grisé ci dessus), un des décorateurs possibles de <b>FilterInputStream</b>, qui transforme en <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Character.html#toUpperCase%28int%29" target="_blank">Majuscule</a> tous les caractères du fichier transmis en paramètre.
            </div>

            <div class="codesource">
                <code>
                    <font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>public&nbsp;</b></font><font color="#7f0055"><b>void&nbsp;</b></font><font color="#000000">testUpperCase_README_TXT</font><font color="#000000">()&nbsp;</font><font color="#7f0055"><b>throws&nbsp;</b></font><font color="#000000">Exception&nbsp;</font><font color="#000000">{</font>
                    <br />
                    <font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">InputStream&nbsp;is&nbsp;=&nbsp;</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">BufferedInputStream</font><font color="#000000">(</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">FileInputStream</font><font color="#000000">(</font><font color="#7f0055"><b>new&nbsp;</b></font><font color="#000000">File</font><font color="#000000">(</font><font color="#2a00ff">&#34;README.TXT&#34;</font><font color="#000000">)))</font><font color="#000000">;&nbsp;</font><font color="#3f7f5f">//&nbsp;d&eacute;claration&nbsp;&agrave;&nbsp;d&eacute;corer</font>
                    <br />
                    <font color="#ffffff"></font>
                    <br />
                    <font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>int&nbsp;</b></font><font color="#000000">c&nbsp;=&nbsp;is.read</font><font color="#000000">()</font><font color="#000000">;</font>
                    <br />
                    <font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#7f0055"><b>while&nbsp;</b></font><font color="#000000">(</font><font color="#000000">c&nbsp;!=&nbsp;-</font><font color="#990000">1</font><font color="#000000">)&nbsp;{</font>
                    <br />
                    <font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">assertTrue</font><font color="#000000">(</font><font color="#2a00ff">&#34;erreur&nbsp;!,&nbsp;'&#34;&nbsp;</font><font color="#000000">+&nbsp;Character.valueOf</font><font color="#000000">((</font><font color="#7f0055"><b>char</b></font><font color="#000000">)&nbsp;</font><font color="#000000">c</font><font color="#000000">)&nbsp;</font><font color="#000000">+&nbsp;</font><font color="#2a00ff">&#34;'&nbsp;ne&nbsp;semble&nbsp;pas&nbsp;&ecirc;tre&nbsp;une&nbsp;majuscule&nbsp;...&#34;</font><font color="#000000">,<br />
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Character.isUpperCase</font><font color="#000000">((</font><font color="#7f0055"><b>char</b></font><font color="#000000">)&nbsp;</font><font color="#000000">c</font><font color="#000000">)&nbsp;</font><font color="#000000">||&nbsp;</font><font color="#000000">(</font><font color="#7f0055"><b>char</b></font><font color="#000000">)&nbsp;</font><font color="#000000">c&nbsp;==&nbsp;</font><font color="#990000">'&nbsp;'</font><font color="#000000">)</font><font color="#000000">;</font>
                    <br />
                    <font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">c&nbsp;=&nbsp;is.read</font><font color="#000000">()</font><font color="#000000">;</font>
                    <br />
                    <font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font>
                    <br />
                    <font color="#ffffff"></font>
                    <br />
                    <font color="#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">is.close</font><font color="#000000">()</font><font color="#000000">;</font>
                    <br />
                    <font color="#ffffff">&nbsp;&nbsp;&nbsp;</font><font color="#000000">}</font>
                </code>
            </div>

            <hr />

            <div class="question">
                <img src="images/question4_2.png" width="111" height="80" />
                <span>La classe PushbackInputStream</span>
            </div>


            <div class="paragraphe">
                Créez une instance de la classe UpperCaseInputStream enrichie des fonctionnalités offertes par la classe <a href="http://docs.oracle.com/javase/7/docs/api/java/io/PushbackInputStream.html" target="_blank">PushbackInputStream</a><br />
                <br />
                Vérifiez en proposant un test supplémentaire de la de test UpperCaseInputStreamTest, le bon fonctionnement de cette instance ainsi décorée....
            </div>


        </div>
        <div id="footer">
            <a class="lien" href="http://jfod.cnam.fr/" target="_blank">JFOD</a> | <a class="lien" href="http://deptmedia.cnam.fr/phpBB2/viewforum.php?f=40" target="_blank">FORUM</a> | <a class="lien" href="http://www.cnam.fr/" target="_blank">CNAM</a>
        </div>
    </div>
</body>
</html>